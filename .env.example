# ============================================================================
# BACKEND - Express + PostgreSQL/CockroachDB
# ============================================================================
# Examples:
#   postgres://user:pass@localhost:5432/contesthub
#   postgresql://user:pass@host:26257/defaultdb?sslmode=verify-full
DATABASE_URL=
PORT=4000
NODE_ENV=development

# ============================================================================
# AUTHENTICATION & SECURITY (CRITICAL)
# ============================================================================
# Generate JWT_SECRET with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=change_me_to_a_32_character_random_string_minimum
OTP_SECRET_KEY=change_me_to_a_long_random_string
# Used to encrypt per-user TOTP secrets (Google Authenticator / TOTP 2FA).
# Recommended: 64-char hex (32 bytes). Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
TOTP_ENCRYPTION_KEY=change_me_to_a_64_char_hex_key

# Frontend origins (comma-separated) - REQUIRED for production
# Do NOT include localhost in production!
FRONTEND_ORIGIN=http://localhost:3000,http://localhost:3001

# Auth cookie configuration
AUTH_COOKIE_NAME=auth_token
CSRF_COOKIE_NAME=csrf_token
AUTH_COOKIE_SAMESITE=lax
# AUTH_COOKIE_SECURE=true  # Enable in production with HTTPS
# AUTH_COOKIE_DOMAIN=.yourdomain.com  # Set for production cross-domain

# How long the auth cookie persists (milliseconds). Default is 24h.
# Shorter is safer; consider 4h (14400000) or 1h (3600000) for production.
AUTH_COOKIE_MAX_AGE_MS=86400000

# Proxy configuration (enable when behind reverse proxy)
# TRUST_PROXY=1  # typical when behind nginx/load balancer

# Security headers
# Enable CORP (Cross-Origin-Resource-Policy) in production if you don't serve cross-origin assets.
HELMET_CORP=false

# Request body limits
# Keep this as small as possible; increase only if you upload large JSON payloads.
JSON_BODY_LIMIT=10mb

# Fail-fast checks for production
# If true, require OTP_EMAIL_URL in production (recommended).
REQUIRE_OTP_EMAIL_URL_IN_PROD=true

# ============================================================================
# EMAIL SERVICE (Choose one option)
# ============================================================================
# Option 1: Resend (Recommended for production)
# RESEND_API_KEY=<your-resend-api-key>

# Option 2: SendGrid
# SENDGRID_API_KEY=<your-sendgrid-api-key>

# Option 3: Gmail (Less secure, app password required)
# GMAIL_USER=your-email@gmail.com
# GMAIL_APP_PASSWORD=<16-character-app-password>
# AUTH_COOKIE_DOMAIN=.example.com

# Payments (SePay webhook)
# Enable payments feature flag (or use FEATURE_PAYMENTS_ENABLED=true)
PAYMENTS_ENABLED=false
PAYMENT_BANK_CODE=MB
PAYMENT_ACCOUNT_NUMBER=0123456789
PAYMENT_ACCOUNT_NAME=NGUYEN VAN A
SEPAY_API_KEY=your_sepay_webhook_secret
# Optional (recommended): allow key rotation without downtime (comma-separated)
# Example: SEPAY_API_KEYS=key_current,key_previous
SEPAY_API_KEYS=
# Optional: allow authenticating webhook via query string (less secure; prefer headers)
# Example: https://<host>/api/payments/sepay/webhook?apiKey=<SEPAY_API_KEY>
SEPAY_WEBHOOK_ALLOW_QUERY_KEY=false
# Optional (recommended): restrict webhook callers by IP (comma-separated IPv4/IPv6; IPv4 CIDR supported)
# Example: SEPAY_WEBHOOK_IP_ALLOWLIST=203.0.113.10,203.0.113.0/24
SEPAY_WEBHOOK_IP_ALLOWLIST=
# Optional (recommended): reduce PII/storage by not persisting raw webhook payload
# Set to "false" to store only normalized fields.
SEPAY_WEBHOOK_STORE_RAW_PAYLOAD=true
PAYMENT_AMOUNT_TOLERANCE_VND=0
# Optional: order code prefix used in bank transfer content (A-Z0-9, max 8)
MEMBERSHIP_ORDER_PREFIX=CHUB
# Optional: checkout order expiry (minutes)
MEMBERSHIP_ORDER_TTL_MINUTES=30

# OpenRouter (AI chat)
OPENROUTER_API_KEY=
CHAT_MODELS=qwen/qwen3-coder,qwen/qwen3-235b-a22b,tngtech/deepseek-r1t2-chimera,mistralai/devstral-2512,meta-llama/llama-3.3-70b-instruct

# Integrations
MEDIA_UPLOAD_SECRET_KEY=
MEDIA_MAX_BYTES=26214400
MEDIA_PUBLIC_FOLDERS=avatars,mentor-blog
OTP_EMAIL_URL=
NOTIFICATION_EMAIL_URL=
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# Redis Caching (OPTIONAL - Highly recommended for production)
# Improves performance by 10x+ for frequently accessed data
# If not set, caching will be disabled gracefully
# Get free Redis: Railway, Upstash, or Redis Labs
# Example formats:
#   redis://localhost:6379
#   redis://:password@redis-host:6379
#   rediss://username:password@redis-host:6380 (SSL)
REDIS_URL=redis://localhost:6379

# Security hardening (recommended for production):
# - Use TLS for any external Redis provider (Upstash/Redis Cloud): set REDIS_URL to rediss://...
# - Enforce TLS in prod unless Redis host is internal (railway.internal/localhost)
REDIS_REQUIRE_TLS_IN_PROD=true
# TLS settings (only applied when TLS is enabled)
REDIS_TLS_REJECT_UNAUTHORIZED=true
# Optional: set SNI servername explicitly if your provider requires it
# REDIS_TLS_SERVERNAME=your-redis-host

# Reliability / performance tuning
# Optional: force DNS/IP family when troubleshooting network issues
# - Set to 4 if IPv6 causes timeouts
# - Set to 6 if IPv4 causes timeouts
# Leave unset for auto
# REDIS_FAMILY=4
REDIS_CONNECT_TIMEOUT_MS=15000
REDIS_COMMAND_TIMEOUT_MS=5000
REDIS_HEALTHCHECK_TIMEOUT_MS=12000
# Avoid command backlog when Redis is down (recommended true in prod)
REDIS_ENABLE_OFFLINE_QUEUE=false

# Sentry Error Monitoring (OPTIONAL - Recommended for production)
# Get your DSN from https://sentry.io
# Provides real-time error tracking and performance monitoring
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# Gemini (Server-side only; keep secrets out of Vite bundles)
GEMINI_API_KEY=

# Frontend (Vite only exposes VITE_*)
VITE_API_URL=http://localhost:4000/api
VITE_CHAT_ENABLED=false
